中断

--------------------------------------------------------------------------------

中断 4位 16种不同优先级，可以将它们分为5组

抢占式优先级，抢占优先级（次优先级）：实现中断嵌套，抢占式优先级越大越先执行，如果相等则比较次优先级，如果两个都相等，按照中断排排号来执行。

NVIC 的优先级组：

================================================================================

NVIC_PriorityGroup   | NVIC_IRQChannelPreemptionPriority |NVIC_IRQChannelSubPriority  | Description

=================================================================================

 NVIC_PriorityGroup_0     |                0                  |            0-15             |  0 bits for pre-emption priority

                                      |                                    |                               |   4bits for subpriority

 -----------------------------------------------------------------------------------------------------------------------------------------------------------------

  NVIC_PriorityGroup_1    |                0-1                |            0-7              |   1 bits for pre-emption priority

                                      |                                     |                              |   3bits for subpriority

 ----------------------------------------------------------------------------------------------------------------------------------------------------------------    

  NVIC_PriorityGroup_2  |                0-3                |            0-3              |   2 bits for pre-emption priority

                                    |                                     |                              |  2 bits for subpriority

 ---------------------------------------------------------------------------------------------------------------------------------------------------------------    

  NVIC_PriorityGroup_3  |                0-7                |            0-1              |   3 bits for pre-emption priority

                                    |                                     |                              |  1 bits for subpriority

 ----------------------------------------------------------------------------------------------------------------------------------------------------------------    

   NVIC_PriorityGroup_4  |                0-15               |            0               |   4 bits for pre-emptionpriority

                                |                                      |                              |  0 bits for subpriority                      

 ==================================================================================

 

Stm32把编号为-3 -> 6 的中断向量定义为系统异常，编号为负的不可以被设置优先级，从编号7开始为外部中断可以被设置中断优先级，具体查询数据手册或启动文件。

 

NMI： 不可屏蔽中断。

NVIC 只可以配置 16 种中断向量的优先级。

AFIO （alternate-function I/O），指 GPIO 端口的复用功能，GPIO 除了用作普通的输入输出（主功能），还可以作为片上外设的复用输入输出，大多数 GPIO 都有一个默认复用功能，有的 GPIO 还有重映射功能。重映射功能是指把原来属于 A 引脚的默认复用功能，转移到 B 引脚进行使用，前提是 B 引脚具有这个重映射功能。

STM32 的所有 GPIO 都引入到 EXTI 外部中断线上，使得所有的 GPIO 都能作为外部中断的输入源。

配置中断步骤：

1-> 开启总中断      __set_PRIMASK(0)；

2-> 开启时钟：包括 GPIOx和AFIO        eg (RCC_APB2Periph_GPIOA| RCC_APB2Periph_AFIO)

3->配置IO:       IO口 和输入模式

4->配置中断线：     填充结构体EXTI_InitTypeDef   初始化

5->配置中断源：     选择中断组NVIC_PriorityGroupConfig(NVIC_PriorityGroup_1);

                    填充结构体NVIC_InitTypeDef  初始化

6->添加中断函数：  #define             macEXTI_INT_FUNCTION                    EXTI0_IRQHandler

void macEXTI_INT_FUNCTION (void){｝



学习《零死角玩转stm32---MINI》